<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Overlay</title>
  <link rel="stylesheet" href="../styles/style.css">
</head>
<body>
  <div class="drag-gutter top" title="Drag window"></div>
  <button id="closeBtn" class="close-btn" title="Close Application">
    <svg class="close-icon" viewBox="0 0 24 24" width="16" height="16">
      <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    </svg>
  </button>

  <div class="fab-container">
    <button id="stopBtn" class="fab-stop" title="Stop Transcription" aria-label="Stop">‚èπstop</button>
  </div>
  

  <div class="scroll-container">
    <div class="tabs">
      <button id="tabSettings" class="tab active" title="Setup (API keys and options)">Setup</button>
      <button id="tabLive" class="tab" title="Live view">Live</button>
      <button id="tabCode" class="tab" title="Code view (pre)">Code</button>
      <button id="tabHistory" class="tab" title="Conversation history">History</button>
      <div class="status-chip" title="Connection and mode">
        <span id="connChip" class="chip conn off">Disconnected</span>
      </div>
    </div>

    <div id="panel-live" class="tab-panel">
      <div id="currentInteraction">
        <div id="caption" class="panel caption-panel">üé§ Waiting for captions...</div>
        <div id="aiResponse" class="panel ai-panel">ü§ñ Waiting for AI response...</div>
      </div>
      <div id="status" class="panel status">Status: idle</div>
    </div>

    <div id="panel-history" class="tab-panel">
      <div id="conversation" class="conversation-container">
        <div class="conversation-header">
          <span>Interview Conversation</span>
          <button id="downloadHistoryBtn" class="small-btn" aria-label="Download transcript" style="margin-left:auto;">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
              <path fill="currentColor" d="M5 20h14a1 1 0 0 0 1-1v-3h-2v2H6v-2H4v3a1 1 0 0 0 1 1zm7-3l5-5h-3V4h-4v8H7l5 5z"/>
            </svg>
          </button>
        </div>
        <div id="conversationHistory" class="conversation-history"></div>
      </div>
    </div>

    <div id="panel-code" class="tab-panel">
      <div class="panel" style="padding:0; position:relative;">
        <button id="copyCodeBtn" class="small-btn" aria-label="Copy code" style="position:absolute; top:4px; right:8px; z-index:2; display:inline-flex; align-items:center; gap:6px;">
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path fill="currentColor" d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/>
          </svg>
        </button>
        <pre id="codeAnswer" style="margin:0; padding:10px; background: rgba(0,0,0,0.25);
          font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;
        ">ü§ñ Code view will appear here‚Ä¶</pre>
      </div>
    </div>

    <div id="panel-settings" class="tab-panel active">
      <div class="panel" id="configPanel">
        <div class="form-group">
          <div class="label-with-info">
            <span class="label-text">AssemblyAI API Key:</span>
            <a href="https://www.assemblyai.com/dashboard/api-keys" target="_blank" class="info-icon" aria-label="AssemblyAI API key help">‚ÑπÔ∏è</a>
          </div>
          <div class="input-with-eye">
            <input id="assemblyKey" type="password" placeholder="Enter AssemblyAI API Key" autocomplete="off">
            <button type="button" class="eye-btn" data-target="assemblyKey" aria-label="Show API key">
              <svg class="eye-icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path fill="currentColor" d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-2.5A2.5 2.5 0 1 0 12 7.5 2.5 2.5 0 0 0 12 14.5z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="form-group">
          <div class="label-with-info">
            <span class="label-text">Gemini API Key:</span>
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="info-icon" aria-label="Gemini API key help">‚ÑπÔ∏è</a>
          </div>
          <div class="input-with-eye">
            <input id="geminiKey" type="password" placeholder="Enter Gemini API Key" autocomplete="off">
            <button type="button" class="eye-btn" data-target="geminiKey" aria-label="Show API key">
              <svg class="eye-icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path fill="currentColor" d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-2.5A2.5 2.5 0 1 0 12 7.5 2.5 2.5 0 0 0 12 14.5z"/>
              </svg>
            </button>
          </div>
        </div>
        <label>Gemini Model:</label>
        <div class="custom-select" id="geminiModelWrap">
          <select id="geminiModel" style="display:none">
            <option value="gemini-2.5-flash">gemini-2.5-flash</option>
            <option value="gemini-1.5-flash">gemini-1.5-flash</option>
            <option value="gemini-pro">gemini-pro</option>
          </select>
          <button type="button" class="custom-select-button" id="geminiModelBtn" aria-haspopup="listbox" aria-expanded="false">
            <span id="geminiModelLabel">gemini-2.5-flash</span>
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" style="margin-left:6px; opacity:0.8;">
              <path fill="currentColor" d="M7 10l5 5 5-5z" />
            </svg>
          </button>
          <ul class="custom-select-list" id="geminiModelList" role="listbox" tabindex="-1" aria-labelledby="geminiModelBtn" hidden>
            <li role="option" data-value="gemini-2.5-flash" class="selected">gemini-2.5-flash</li>
            <li role="option" data-value="gemini-1.5-flash">gemini-1.5-flash</li>
            <li role="option" data-value="gemini-pro">gemini-pro</li>
          </ul>
        </div>
        <button id="startBtn">‚ñ∂Ô∏è Start</button>

        <hr style="margin:16px 0; opacity:0.5;" />
        <div class="form-group">
          <div class="label-with-info">
            <span class="label-text">VB-CABLE Setup:</span>
            <a href="https://vb-audio.com/Cable/" target="_blank" class="info-icon" aria-label="VB-Audio Cable website">‚ÑπÔ∏è</a>
          </div>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <button id="vbInstallBtn" type="button" title="Open VB-CABLE download page">Install / Verify</button>
            <button id="vbApplyBtn" type="button" title="Apply routing (opens Control Panel)">Apply Routing</button>
            <span id="vbStatus" style="margin-left:auto; font-size:12px; opacity:0.8;">VB-CABLE: Unknown</span>
          </div>
          <div style="font-size:12px; opacity:0.9; margin-top:8px; line-height:1.4;">
            <div style="margin-bottom:6px;"><strong>Install VB-CABLE</strong> (if not installed):</div>
            <ol style="margin:0 0 8px 18px; padding:0;">
              <li>Scroll to <em>VB-CABLE Driver (Donationware)</em> and click <strong>Download</strong>.</li>
              <li>Extract ZIP: Right-click the zip ‚Üí <strong>Extract All‚Ä¶</strong></li>
              <li>Right-click <strong>VBCABLE_Setup_x64.exe</strong> ‚Üí <strong>Run as Administrator</strong>.</li>
              <li>Click <strong>Install Driver</strong>, wait for completion, then <strong>Restart PC</strong>.</li>
            </ol>
            <div style="margin:8px 0 6px 0;"><strong>After install, configure routing</strong> (Apply Routing can help open the dialogs):</div>
            <ol style="margin:0 0 0 18px; padding:0;">
              <li><strong>Playback (Default)</strong>: Set <em>CABLE Input (VB-Audio Virtual Cable)</em> as Default device.</li>
              <li><strong>Recording (Default)</strong>: Set your <em>Microphone Array (physical mic)</em> as Default device.</li>
              <li><strong>Recording > Microphone (click) > Properties > Listen</strong>:
                <ul style="margin:4px 0 0 16px;">
                  <li>Uncheck <em>"Listen to this device"</em>.</li>
                  <li>Set <em>Playback through this device</em> to <em>CABLE Input</em>. Click Apply, then OK.</li>
                </ul>
              </li>
              <li><strong>Recording ‚Üí CABLE Output (click) ‚Üí Properties ‚Üí Listen</strong>:
                <ul style="margin:4px 0 0 16px;">
                  <li>Check <em>"Listen to this device"</em>.</li>
                  <li>Set <em>Playback through this device</em> to your speakers/headphones (e.g., <em>Speaker/HP (Realtek High Definition Audio)</em>).</li>
                </ul>
              </li>
              <li><strong>Do NOT</strong> set <em>CABLE Output</em> as a default device.</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

  </div> 

  <div class="input-panel">
    <input id="askInput" type="text" placeholder="Ask Gemini anything..." class="ask-input">
    <button id="askBtn" class="ask-button">Ask</button>
  </div>

  <script src="../renderer.js"></script>
</body>
</html>
